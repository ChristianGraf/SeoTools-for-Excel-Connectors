<?xml version="1.0" encoding="utf-8" ?>
<Suite RequireVersion="5.1" Title="Google Search Console" Id="GoogleSearchConsole" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/GoogleSearchConsole.xml" HelpUrl="http://seotoolsforexcel.com/google-search-console/" HelpText="Documentation">

  <GoogleOAuth2Authenticator ClientId="" ClientSecret="" Scope="https://www.googleapis.com/auth/webmasters.readonly" StayAuthenticated="true"/>

  <RestConnector Id="Sites" Title="Sites" Hidden="true">
    <Parameters>
    </Parameters>
    <Fetch Url="https://www.googleapis.com/webmasters/v3/sites?fields=siteEntry">
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.siteEntry.*">
        <JsonPath Expr="siteUrl" Id="Id" Title="Id"/>
        <JsonPath Expr="siteUrl" Id="Title" Title="Title"/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="Analytics" Title="Analytics">
    <Parameters>
      <Text Id="Site" Title="Site" DefaultValue="" Required="true" Select.Connector="Sites"/>
    </Parameters>
    <Fetch Url="https://www.googleapis.com/webmasters/v3/sites/@Utils.UrlEncode(Model.Site)/searchAnalytics/query?fields=responseAggregationType%2Crows">
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
        <RequestMethod>POST</RequestMethod>
        <RequestContentType>application/json</RequestContentType>
        <RequestBody>
          {
            "startDate": "2015-01-01",
            "endDate": "2015-10-01",
            "dimensions": [
              "country",
              "device"
            ]
          }
        </RequestBody>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.rows.*">
        <JsonPath Expr="clicks" Id="Clicks" Title="Clicks" Converter="Int"/>
        <JsonPath Expr="impressions" Id="Impressions" Title="Impressions" Converter="Int"/>
        <JsonPath Expr="ctr" Id="Ctr" Title="Ctr" Converter="Double"/>
        <JsonPath Expr="position" Id="Position" Converter="Double"/>
      </JsonPath>
    </Parse>
  </RestConnector>
  
  <RestConnector Id="Sitemaps" Title="Sitemaps">
    <Parameters>
      <Text Id="Site" Title="Site" DefaultValue="" Required="true" Select.Connector="Sites"/>
    </Parameters>
    <Fetch Url="https://www.googleapis.com/webmasters/v3/sites/@(Utils.UrlProperty(Model.Site).Domain)/sitemaps?fields=sitemap">
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.sitemap.*">
        <JsonPath Expr="path" Id="Path" Title="Path"/>
        <JsonPath Expr="lastSubmitted" Id="LastSubmitted" Title="Last submitted" Converter="DateTime"/>
        <JsonPath Expr="isPending" Id="IsPending" Title="Is pending" Converter="Bool"/>
        <JsonPath Expr="isSitemapsIndex" Id="IsSitemapsIndex" Title="Is sitemaps index" Converter="Bool"/>
        <JsonPath Expr="lastDownloaded" Id="lastDownloaded" Title="Last downloaded" Converter="DateTime"/>
        <JsonPath Expr="warnings" Id="Warnings" Title="Warnings" Converter="Int"/>
        <JsonPath Expr="errors" Id="Errors" Title="Errors" Converter="Int"/>
      </JsonPath>
    </Parse>
  </RestConnector>

</Suite>
